# 用户消息推还是拉

一般来说推拥有实时性,对方能够马上收到用户发送的的消息.定时轮询拉取会有一定的延迟.但是推送消息的话需要服务器记录客户端已获取的消息位点,这样就会存在一个弊端,如果一个用户可以登录多个客户端同时在线,这将无法满足要求.这时候我们可以选择推拉结合
1. 用户登录上线时会主动拉取离线期间未读取的历史消息
2. 拉取到历史消息后存储本地最新的消息id(单调递增)
3. 当有其他用户发送消息过来时,服务器只负责通知所有该用户的客户端,有新消息,并且当前最大的消息id是多少
4. 客户端收到通知后,查询本地最新的消息id,如果消息id小于服务器通知的消息id,客服端则根据本地最新的消息id各自拉取自己的差量.

推送时可以启动一个定时器等100ms再推送,这样100ms之内的消息,合并只推送一次,拉取的时候也可以类似的等100ms再拉取可以减少网络请求的次数.